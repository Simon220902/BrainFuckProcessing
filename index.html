<html>
<head>
	<meta charset="utf-8"/>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono"/>
	<link rel="stylesheet" href="data/style/bootstrap.min.css">
	<link rel="stylesheet" href="data/style/styles.css">
	<script src="data/p5.js"></script>
	<script src="bf.js"></script>
</head>
<body>
		<script>
            let mainInterval;
            let intervalSpeed = 100;
			let program;
			let interp;
			let examplePrograms;
			let doing_step_through = false;
			let pause = true;
			
			//Man kan først få adgang til elementerne efter at de er etableret i DOM'en
			window.onload = function () {
				examplePrograms = document.getElementById("examples");
				program = examplePrograms.options[examplePrograms.selectedIndex].value;
				document.getElementById("code").value = program;
				interp = new Interpreter(program);
			};

			//Denne kører koden der står i kode vinduet på "en gang" og propper resultatet i output paragraph
			function run() {
					program = document.getElementById("code").value;
					interp = new Interpreter(program);
					interp.eval();
					document.getElementById("output").innerHTML = interp.output;
					updateTape();
			}

			function pauseProgram(){
				//Vi skal sørge for at stoppe 
                clearInterval(mainInterval);
                mainInterval = null;
			}

			function highlight() {
				let index = interp.programIndex;
				innerHTML = program.substring(0,index-1) + "<mark>" + program.substring(index-1,index) + "</mark>" + program.substring(index);
				document.getElementById("code_text").innerHTML = innerHTML;
            }
            
			//Stepthrough funktionen
			function stepThrough(){
				if (doing_step_through){
					interp.step();
					document.getElementById("output").innerHTML = interp.output;
					updateTape();
					highlight();
					//Vi tjekker om programmet er færdigt så det ikke bliver ved med at køre og så stopper vi det, hvis det var igang med autostepthrough
					if(interp.done){
						doing_step_through = false;
						pauseProgram();
						interp.done = false;
					}
				}
				else{
					program = document.getElementById("code").value;
					interp = new Interpreter(program);
					interp.step();
					document.getElementById("output").innerHTML = interp.output;
					updateTape();
					doing_step_through = true;
					document.getElementById("code_text").innerHTML = program;
					highlight();
				}
			}

			function autoStepthrough(){
                //Tids intervallet skal afgøre
                if (mainInterval == null){
                    mainInterval = setInterval(stepThrough, intervalSpeed);
                }
				//Så længde den ikke er færdig med at køre...
				//Så skal den afvikle et symbol, update det hele osv.

			}

			//Hvis der vælges et andet eksempel program, så skifter vi koden i kode vinduet
			function changeProgram(){
				program = examplePrograms.options[examplePrograms.selectedIndex].value;
				document.getElementById("code").value = program;
				doing_step_through = false;
			}

			function changeSpeed(){
				intervalSpeed = document.getElementById("speed_slider").value;
				document.getElementById("speed_display").innerHTML = intervalSpeed;
			}

			function updateTape(){
				if (interp.tapeIndex >= 9){
					for (let i = 0; i < 10; i++){
						let cell = document.getElementById("t"+i.toString())
						cell.innerHTML = interp.tape[interp.tapeIndex+i-5];
						cell.style.backgroundColor = "#bbb4b4";
					}
					document.getElementById("t5").style.background="red";
				}
				else{
					for (let i = 0; i < 10; i++){
						let cell = document.getElementById("t"+i.toString())
						cell.innerHTML = interp.tape[i];
						cell.style.backgroundColor = "#bbb4b4";
					}
					document.getElementById("t"+interp.tapeIndex.toString()).style.backgroundColor="red";
				}
			}
		</script>

	<h1>Brainfuck with P5</h1>
	<p>This was made as a school project. Find more information at <a href="https://github.com/simon220902/BrainFuckProcessing">the readme of my git.</a></p>
	<h3>Tape</h3>
	<div class="table-responsive">
		<table class="table">
			<thead style="background-color: #ffffff21">
				<tr>
					<th id="t0">0</th>
					<th id="t1">0</th>
					<th id="t2">0</th>
					<th id="t3">0</th>
					<th id="t4">0</th>
					<th id="t5">0</th>
					<th id="t6">0</th>
					<th id="t7">0</th>
					<th id="t8">0</th>
					<th id="t9">0</th>
				</tr>
		</table>
	</div>
	<h3>Code</h3>
	<textarea id="code" cols=100 rows=20></textarea>
	<p id="code_text"></p>
	<button class="btn btn-primary" style="background-color:#bbb4b4;" onclick="run()">Run</button>
    <button class="btn btn-primary" style="background-color:#1c6643;" onclick="stepThrough()">Step</button>
    <button class="btn btn-primary" style="background-color:#1c6643;" onclick="autoStepthrough()">AutoStep</button>
	<button class="btn btn-primary" style="background-color:#1c6643;" onclick="pauseProgram()">Pause</button>
	<select id="examples" onchange="changeProgram()">
		<option value="++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[<]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+.>++." selected="selected">Hello world</option>
		<option value=">+++++++++[<+++++++++++>-]<[>[-]>[-]<<[>+>+<<-]>>[<<+>>-]>>> [-]<<<+++++++++<[>>>+<<[>+>[-]<<-]>[<+>-]>[<<++++++++++>>>+< -]<<-<-]+++++++++>[<->-]>>+>[<[-]<<+>>>-]>[-]+<<[>+>-<<-]<<< [>>+>+<<<-]>>>[<<<+>>>-]>[<+>-]<<-[>[-]<[-]]>>+<[>[-]<-]<+++ +++++[<++++++<++++++>>-]>>>[>+>+<<-]>>[<<+>>-]<[<<<<<.>>>>>- ]<<<<<<.>>[-]>[-]++++[<++++++++>-]<.>++++[<++++++++>-]<++.>+ ++++[<+++++++++>-]<.><+++++..--------.-------.>>[>>+>+<<<-]> >>[<<<+>>>-]<[<<<<++++++++++++++.>>>>-]<<<<[-]>++++[<+++++++ +>-]<.>+++++++++[<+++++++++>-]<--.---------.>+++++++[<------ ---->-]<.>++++++[<+++++++++++>-]<.+++..+++++++++++++.>++++++ ++[<---------->-]<--.>+++++++++[<+++++++++>-]<--.-.>++++++++ [<---------->-]<++.>++++++++[<++++++++++>-]<++++.----------- -.---.>+++++++[<---------->-]<+.>++++++++[<+++++++++++>-]<-. >++[<----------->-]<.+++++++++++..>+++++++++[<---------->-]< -----.---.>>>[>+>+<<-]>>[<<+>>-]<[<<<<<.>>>>>-]<<<<<<.>>>+++ +[<++++++>-]<--.>++++[<++++++++>-]<++.>+++++[<+++++++++>-]<. ><+++++..--------.-------.>>[>>+>+<<<-]>>>[<<<+>>>-]<[<<<<++ ++++++++++++.>>>>-]<<<<[-]>++++[<++++++++>-]<.>+++++++++[<++ +++++++>-]<--.---------.>+++++++[<---------->-]<.>++++++[<++ +++++++++>-]<.+++..+++++++++++++.>++++++++++[<---------->-]< -.---.>+++++++[<++++++++++>-]<++++.+++++++++++++.++++++++++. ------.>+++++++[<---------->-]<+.>++++++++[<++++++++++>-]<-. -.---------.>+++++++[<---------->-]<+.>+++++++[<++++++++++>- ]<--.+++++++++++.++++++++.---------.>++++++++[<---------->-] <++.>+++++[<+++++++++++++>-]<.+++++++++++++.----------.>++++ +++[<---------->-]<++.>++++++++[<++++++++++>-]<.>+++[<-----> -]<.>+++[<++++++>-]<..>+++++++++[<--------->-]<--.>+++++++[< ++++++++++>-]<+++.+++++++++++.>++++++++[<----------->-]<++++ .>+++++[<+++++++++++++>-]<.>+++[<++++++>-]<-.---.++++++.---- ---.----------.>++++++++[<----------->-]<+.---.[-]<<<->[-]>[ -]<<[>+>+<<-]>>[<<+>>-]>>>[-]<<<+++++++++<[>>>+<<[>+>[-]<<-] >[<+>-]>[<<++++++++++>>>+<-]<<-<-]+++++++++>[<->-]>>+>[<[-]< <+>>>-]>[-]+<<[>+>-<<-]<<<[>>+>+<<<-]>>>[<<<+>>>-]<>>[<+>-]< <-[>[-]<[-]]>>+<[>[-]<-]<++++++++[<++++++<++++++>>-]>>>[>+>+ <<-]>>[<<+>>-]<[<<<<<.>>>>>-]<<<<<<.>>[-]>[-]++++[<++++++++> -]<.>++++[<++++++++>-]<++.>+++++[<+++++++++>-]<.><+++++..--- -----.-------.>>[>>+>+<<<-]>>>[<<<+>>>-]<[<<<<++++++++++++++ .>>>>-]<<<<[-]>++++[<++++++++>-]<.>+++++++++[<+++++++++>-]<- -.---------.>+++++++[<---------->-]<.>++++++[<+++++++++++>-] <.+++..+++++++++++++.>++++++++[<---------->-]<--.>+++++++++[ <+++++++++>-]<--.-.>++++++++[<---------->-]<++.>++++++++[<++ ++++++++>-]<++++.------------.---.>+++++++[<---------->-]<+. >++++++++[<+++++++++++>-]<-.>++[<----------->-]<.+++++++++++ ..>+++++++++[<---------->-]<-----.---.+++.---.[-]<<<]">Bottles</option>
		<option value="26 +++++ +++++ +++++ +++++ +++++ +>
				A  +++++ +++++ +++++ +++++ +++++ +++++ +++++ +++++ +++++ +++++ +++++ +++++ +++++
				   <
				   [>.+<-]">Alphabet</option>
		<option value="">Pong</option>
	</select>
	<input type="range" min="1" max="100" value="50" class="slider" id="speed_slider" onchange="changeSpeed()">
    <p id="speed_display"></p>
    <h3>Output</h3>
	<p style="height: 100;" id="output"></p>
	
	<script type="text/javascript" src="sketch.js"></script>
	<h1>A quick guide</h1>
</body>
</html>